# 5. Dockerfile 활용해 이미지 만들기
## 5.1 Dockerfile이란?
Docker 이미지는 Dockerhub을 통해 다운받아서 사용할 수 있다. 이 Docker 이미지들도 누군가 만들어서 Dockerhub에 올려놓은 것이다. 그럼 도대체 이 Dcoker 이미지는 어떻게 만드는 걸까?

> **Dockerfile**이라는 걸 활용해서 Docker 이미지를 만들 수 있다.

Dockerhub에 올려놓은 Docker 이미지가 아닌, 나만의 Docker 이미지를 만들고 싶을 수 있다. 예를 들어, 내가 만든 Spring Boot 프로젝트가 있다. 내가 만든 Spring Boot 프로젝트 자체를 Docker 이미지로 만들고 싶을 수 있다. 이럴 때에도 Dockerfile을 활용하면 나만의 Docker 이미지를 만들 수 있게 된다.
정리하자면, **Dockerfile**이란 **Docker 이미지를 만들게 해주는 파일**이다.

## 5.2 FROM: 베이스 이미지 생성
### 5.2.1 의미
`FROM`은 베이스 이미지를 생성하는 역할을 한다. Docker 컨테이너를 **특정 초기 이미지**를 기반으로 추가적인 셋팅을 할 수 있다. 여기서 얘기한 ‘특정 초기 이미지’가 곧 **베이스 이미지**이다.

> 조금 더 쉽게 설명해보겠다.

우리가 윈도우 컴퓨터를 새로 사서 실행시켜보면 기본 프로그램들(인터넷, 그림판, 메모장 등)이 많이 깔려있다. 베이스 이미지도 이와 똑같다. 컨테이너를 새로 띄워서 미니 컴퓨터 환경을 구축할 때 기본 프로그램이 어떤게 깔려있으면 좋겠는 지 선택하는 옵션이라고 생각하면 된다.

누군가는 JDK가 깔려있는 컴퓨터 환경이 셋팅되기를 바랄 수도 있고, 누군가는 Node가 깔려있는 컴퓨터 환경이 셋팅되기를 바랄 수도 있다. 필요에 따라 베이스 이미지를 고르면 된다.

### 5.2.2 사용법
```docker
# 문법
FROM [이미지명]
FROM [이미지명]:[태그명]
```
- `태그명`을 적지 않으면 해당 이미지의 최신(latest) 버전을 사용한다.

### 5.2.3 예시
1. 프로젝트 최상단에 `Dockerfile` 이란 이름으로 파일을 만들어준다.
```docker
# Dockerfile
FROM openjdk:17-jdk
```

2. 해당 파일이 있는 디렉토리에서 아래와 같이 입력해준다.(태그를 적어줘도 된다.)
```bash
docker build -t [이미지명]:[태그명] [Dockerfile이 존재하는 디렉터리 경로]
docker build -t my-jdk17-server .
```
- `-t`: 이미지의 이름을 정한다
- `.`: 상대경로로 `Dockerfile`을 찾는다.
- 지금은 태그가 latest로 만들어진다.

3. Dockerfile 내부에 컨테이너가 작업할 내용들이 있으며 그 내용들이 완료되면 컨테이너는 자동 종료된다.
4. 컨테이너 내부로 들어가서 jdk가 잘 깔렸는지 확인해보고 싶다면
```docker
FROM openjdk:17-jdk

ENTRYPOINT ["/bin/bash", "-c", "sleep 500"]
```

```bash
$ docker build -t my-jdk17-server . # 이미지 빌드
$ docker run -d my-jdk17-server # 컨테이너 실행
$ docker ps # 실행 중인 컨테이너 조회
$ docker exec -it [컨테이너 ID] bash # 컨테이너 접속

$ java -version # JDK 설치되어 있는 지 확인
```

## 5.3 종료된 컨테이너에 들어가서 디버깅하고 싶을 때
Docker를 사용하면 대부분의 코드가 컨테이너 내부에서 작동한다. 그러다보니 어떤 과정으로 처리됐는 지, 잘 처리는 됐는 지를 직접적으로 눈에 보이지 않는다. 이 때문에 Docker 학습에 어려움을 겪는다.

이를 해결하기 위해 우리는 2가지 방법을 이미 익혔다.

- `docker logs`를 활용해 컨테이너 로그 확인하기
- `docker exec -it`를 활용해 컨테이너 내부에 직접 들어가보기

위 방법 중 `docker exec -it`은 실행 중인 컨테이너에만 쓸 수 있는 명령어이다. 종료된 컨테이너는 아래와 같은 에러가 발생한다.