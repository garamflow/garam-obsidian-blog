# 4. 이미지 빌드
## 4.1 이미지와 레이어(Layer)
이미지는 컨테이너를 실행하기 위한 읽기 전용 파일입니다. 도커의 이미지는 저장소를 효율적으로 사용하기 위해서 레이어드 파일 시스템으로 구성되어 있습니다. 여기서 레이어는 하나의 층을 말합니다.
![이미지 레이어드 파일 시스템](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어드%20파일%20시스템.png)

### 4.1.1 레이어드 파일 시스템을 사용하는 이유
이미지의 레이어는 순차적으로 쌓이고 각각의 레이어는 이전 레이어의 변경된 부분을 저장합니다. 같은 변경이 일어난 레이어는 공유해서 재사용할 수 있습니다.
- 이미지의 레이어는 변경 불가능

1. 레이어드 파일 시스템을 사용하면 공간을 효율적으로 사용할 수 있고 재활용에 유리합니다.
![이미지 레이어드 파일 시스템 장점1](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어드%20파일%20시스템%20장점1.png)

2. 효율적으로 데이터 저장과 전송이 가능합니다.
받는 사람이 설계도 B의 전기부분만 받으면 되기 때문에 효율적입니다.
![이미지 레이어드 파일 시스템 장점2](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어드%20파일%20시스템%20장점2.png)

3. 이전 레이어의 변경 사항을 저장할 수 있습니다.
![이미지 레이어드 파일 시스템 장점3](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어드%20파일%20시스템%20장점3.png)

### 4.1.2 이미지 레이어와 컨테이너 레이어
이미지 레이어는 컨테이너 실행하기 위한 세이브 포인트 역할을 하며 컨테이너 레이어는 이미지를 컨테이너로 실행하고 프로세스가 변경하는 내용을 기록하는 레이어입니다. 컨테이너 레이어는 읽기/쓰기 레이어라서 컨테이너 레이어 한 장이 읽기 전용 레이어들 상단인 이미지에 추가되어서 컨테이너 실행 중 변경되는 내용만 기록됩니다.

![이미지 레이어와 컨테이너 레이어](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어와%20컨테이너%20레이어.png)

![이미지 레이어와 컨테이너 레이어2](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어와%20컨테이너%20레이어2.png)

### 4.1.2 예시
```bash
# 이미지의 레이어 이력 조회
$ docker image history 이미지명
```

![이미지 레이어 예시1](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어%20예시1.png)
![이미지 레이어 예시2](/media/도구%20및%20환경/Docker/강의%20정리/데브위키/개발자를%20위한%20쉬운%20도커/이미지%20레이어%20예시2.png)

### 4.1.3 개념 정리
Layering: 각 레이어는 이전 레이어 위에 쌓이며, 여러 이미지 간에 공유될 수 있습니다. 레이어 방식은 중복데이터를 최소화하고, 빌드 속도를 높이며, 저장소를 효율적으로 사용할 수 있게 해줍니다.

Copy-on-Write￾(CoW)￾전략 :￾다음 레이어에서 이전 레이어의 특정 파일을 수정 할 때,￾해당 파일의 복사본을

만들어서 변경 사항을 적용합니다.￾이렇게 함으로써 원래 레이어는 수정되지 않고 그대로 유지됩니다.

Immutable￾Layers￾(불변 레이어)￾:￾이미지의 각 레이어는 불변으로,￾한 번 생성되면 변경되지 않습니다.￾이렇게

함으로써 이미지의 일관성을 유지하고,￾여러 컨테이너에서 안전하게 공유할 수 있습니다.

Caching￾(캐싱)￾: 레이어를 캐시하여,￾이미 빌드된 레이어를 재사용할 수 있습니다.￾이는 이미지 빌드 시간을 크게

줄여주며,￾같은 레이어를 사용하는 여러 이미지에서 효율적으로 작동합니다.