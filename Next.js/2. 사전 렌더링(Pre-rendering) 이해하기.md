# 2. 사전 렌더링(Pre-rendering) 이해하기

## 2.1 사전 렌더링이란?
- 브라우저의 요청에 사전에 렌더링이 완료된 HTML을 응답하는 렌더링 방식이다.
- CSR (Client Side Rendering)의 단점을 효율적으로 해결하는 기술이다.

## 2.2 CRS (Client Side Rendering)
- React.js 앱의 기본적인 렌더링 방식이다.
- 클라이언트(브라우저)에서 직접 화면을 렌더링하는 방식이다.

### 진행 방식
1. 사용자가 브라우저를 통해 서버에 접속 요청을 한다.
2. 서버는 빈 껍데기 index.html을 브라우저에 보낸다.
3. 브라우저는 사용자에게 빈 화면을 렌더링한다.
	- 사용자가 보는 화면에서는 아무것도 보이지 않는다.
4. 서버는 모든 자바스크립트 코드(리액트 앱)를 번들링(JS Bundle)해서 후속으로 브라우저에게 보낸다.
	- 해당 서비스에서 접근 가능한 모든 컴포넌트 코드가 존재한다.
5. 브라우저는 자바스크립트 코드(리액트 앱)를 실행시킨다.
6. 실제 컨텐츠가 렌더링되면서 사용자에게 화면이 보인다.
7. 이후 사용자가 다른 요청을 보내도 브라우저에 자바스크립트 코드들이 존재하므로 빠른 속도로 컨텐츠를 렌더링할 수 있다.
	- 자바스크립트 코드들을 실행(컴포넌트 교체)

### 사용 시 장점과 단점
- 초기 접속 이후 페이지 이동이 매우 빠르고 쾌적하다는 장점이 있다.
- 단, 초기 접속 속도(FCP)가 느리다는 단점이 있다.

> [!NOTE] FCP (First Contentful Paint)
> - "요청 시작" 시점부터 컨텐츠가 화면에 처음 나타나는데 걸리는 시간을 말한다.
> - 요청시작 <---> 컨텐츠 렌더링
> - 3sec 이상일 경우: 이탈률 32% 증가
> - 5sec 이상일 경우: 이탈률 90% 증가
> - 6sec 이상일 경우: 이탈률 106% 증가
> - 10sec 이상일 경우: 이탈률 123% 증가


## 2.3 사전 렌더링
1. 사용자가 브라우저를 통해 서버에 접속 요청을 한다.
2. 서버가 직접 자바스크립트 코드(리액트 앱)을 실행시켜서 사전에 렌더링된 HTML로 만든다.
3. 렌더링 된 HTML을 브라우저에게 그대로 보내준다.
4. 브라우저 화면에 렌더링된 HTML을 보여주고 사용자는 화면에 바로 렌더링된 화면을 볼 수 있다.
	- 여기까지가 **FCP**이다.
	- 하지만 아직 HTML 하나만 받아서 인터렉션(상호작용)이 불가능하다.
5. Next.js 서버가 후속으로 자바스크립트 코드(리액트 앱)을 번들링(JS Bundle)해서 브라우저에게 보내준다.
6. 브라우저는 자바스크립트 코드를 실행해서 HTML과 연결해준다.
	- 이렇게 상호작용이 가능해지는 과정을 **수화(Hydration)** 이라고 부른다.
7. 수화 과정까지 거치면 웹 페이지가 상호작용까지 가능해진다.
	- 첫 요청부터 상호작용 가능해지는 시점까지를 **TTI (Time To Interactive)** 라고 부른다.
	- 이후 과정은 클라이언트 사이드 렌더링 방식으로 처리된다.
8. 이후 페이지 이동 요청이 들어오면 브라우저에서 자바스크립트 코드들을 실행(컴포넌트 교체)한다.
9. 그리고 화면에 페이지를 교체해서 보여주게 된다.


> [!NOTE] 렌더링 (Rendering)
> 1. JS 실행 (렌더링): 자바스크립트 코드(React 컴포넌트)를 HTML로 변환하는 과정
> 2. 화면에 렌더링: HTML 코드를 브라우저가 화면에 그려내는 작업

## 2.4 사전 렌더링의 결과
- React.js의 단점을 해소해서 빠른 FCP를 발성하고 React.js의 장점인 빠른 페이지 이동을 승계했다.