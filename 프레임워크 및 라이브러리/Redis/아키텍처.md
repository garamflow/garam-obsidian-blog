# 아키텍처
## 1. Simple Database
- Primary
- 레디스 메인 프로세스 하나만 있다.
- 단 하나의 인스턴스만 존재해서 문제가 생기면 사용할 수 없다.
- 고가용성을 보장하지 못한다.
- 충분한 메모리와 서버 리소스를 혼자서 다 사용할 수 있다.

## 2. Ha Database
- 메인과 서브(복제)가 있다.
- 복제는 비동기식으로 동작한다.
- 메인에 들어오는 명령을 버퍼 형태로 서브에 전송하면서 복제한다.
- 어느정도의 가용성을 챙길 수 있다.
- 자동 복구를 지원하지 않기에 많이 사용하지 않는다.

- HA (고가용성)
	- 일종의 대비책이다.
	- 장애상황에 대해 자동 조치를 해주는 환경을 의미한다.

## 3. 레디스의 Sync 과정
- 레디스는 복제본에 대해서 ID값을 그룹핑해서 가지고 있고, 각각의 인스턴스마다 데이터에 대한 OffSet이 존재한다.
- 두 가지 값을 이용해 복제본이 복제 프로세스에 유효한지 판단한다.
- OffSet은 순차적으로 증가한다.
	- 데이터가 Sync가 되면 증가한다.
- ID 그룹과 OffSet을 통해서 동기화 진행여부를 결정 및 진행한다.
- 복제 인스턴스의 OffSet보다 메인 OffSet보다 낮다면 복제가 덜되어서 동기화가 진행된다.


## 4. Sentinel
- 각각의 클러스터들이 함께 동작하면서 고가용성을 보장하는데 집중되있다.
- 분산되어있어서 단일 실패 지점이 발생하지 않고 자동적으로 메인 인스턴스의 상태를 감지하고 변경해준다.
- 모니터링
	- 각각의 센티널 노드들이 마스터, 복제본 인스턴스들을 감시한다.
- 자동 장애 조치
	- 고가용성을 보장해준다.
	- 마스터 노드가 정상적으로 동작하지 않으면 복제노드를 마스터 노드로 승급시켜주고 다른 복제본이 새로운 마스터를 바라볼 수 있게해준다.
- 알림 서비스
- 어떻게 판단?
	- 지속적으로 각각의 인스턴스를 모니터링한다.
	- 센티널 노드는 하나로 구성되어있지않다.
		- 최소 3개 이상을 권장하고 있다.
		- 홀수를 권장한다.
		- 합의 과정에서 과반수로 합의가 되어야 합의된다고 판단된다.
	- 쿼럼이라는 과정이 일어난다.
		- 다섯개의 센티널 노드가 있다면 모니터링하면서 인스턴스들에 핑을 전송해서 응답값이 확인되는지 안되는지 판단한다.
		- 그러다 특정 노드가 메인이 죽은걸 알아채면 다른 노드들에게 전파를 한다.
		- 실제 메인이 죽어있는지 먼저 확인한 노드들은 투표를 하게 된다.
		- 죽었다는 표가 과반수면 복제 인스턴스를 메인 인스턴스로 승급시켜준다.

