## 1) HttpServletRequest - 개요
### (1) `HttpServletRequest` 역할
- HTTP 요청 메서드를 개발자가 직접 파싱해서 사용해도 되지만 매우 불편하다.
- 서블릿은 개발자가 HTTP 요청 메시지를 편리하게 사용할 수 있도록 HTTP 요청 메시지를 파싱한다. 그리고 그 결과를 `HttpServletRequest` 객체에 담아서 제공한다.

### (2) HTTP 요청 메시지
```text
POST /save HTTP/1.1
Host: localhost:8080
Content-Type: application/x-www-form-urlencoded

username=kim&age=20
```
- START LINE
	- HTTP 메서드
	- URL
	- 쿼리스트링
	- 스키마, 프로토콜
- 헤더
	- 헤더 조회
- 바디
	- form 파라미터 형식 조회
	- message body 데이터 직접 조회

### (3) `HttpServletRequest` 의 부가기능들
#### 임시 저장소 기능
- 해당 HTTP 요청이 시작부터 끝날 때 까지 유지되는 임시 저장소 기능
	- 저장 : `request.setAttribute(name, value)`
	- 조회 : `reqeust.getAttribute(name)`
#### 세션 관리 기능
- `request.getSession(create: true)`

>[!note] 중요
>`HttpServletRequest`, `HttpServletResponse`를 사용할 때 가장 중요한 점은 해당 객체들이 HTTP 요청 메시지, HTTP 응답 메시지를 편리하게 사용하도록 도와주는 객체라는 점이다. 따라서 이 기능에 대해 이해하려면 "HTTP 스펙이 제공하는 요청, 응답 메시지 자체를 이해"해야한다.

## 2) HTTP 요청 데이터 - 개요
- HTTP 요청 메시지를 통해 클라이언트에서 서버로 데이터를 전달하는 방법은 주로 세 가지 방법을 사용한다.
### (1) GET - 쿼리 파라미터
- `/url?username=hello&age=20`
- 메시지 바디 없이 쿼리 마라미터에 데이터를 포함해서 전달한다.
- 예) 검색, 필터, 페이징 등에서 많이 사용된다.
### (2) POST - HTML Form
- `content-type: application/x-www-form-urlencoded`
- 메시지 바디에 쿼리 파라미터 형식으로 전달한다.
	- `username=hello&age=20`
- 예) 회원 가입, 상품 주문, HTML Form 에서 사용된다.
### (3) HTTP message body에 데이터를 직접 담아서 요청
- HTTP API에서 주로 사용한다.
	- JSON, XML, TEXT
- 데이터 형식은 주로 JSON을 사용한다.
- POST, PUT, PATCH

## 3) HTTP 요청 데이터 - GET 쿼리 파라미터
- 메시지 바디 없이 URL의 쿼리 파라미터를 사용해서 데이터를 전달한다.
- 주로 검색, 필터, 페이징 등에서 많이 사용한다.
- 쿼리 파라미터는 URL에 `?` 를 시작으로 보낼 수 있다. 추가 파라미터는 `&`으로 구분한다.
	- `http://localhost:8080/request-param?username=kim&age=20`
### 쿼리 파라미터 조회 메서드
```java
//단일 파라미터 조회
String username = request.getParameter("username");
//파라미터 이름들 모두 조회
Enumeration<String> parameterNames = request.getParameterNames();
//파라미터를 Map으로조회
Map<String, String[]> parameterMap = request.getParameterMap();
//복수 파라미터 조회
String[] usernames = request.getParameterValues("username");
```

## 4) HTTP 요청 데이터 - POST HTML Form
- 주로 회원 가입, 상품 주문 등에서 사용하는 방식이다.
### 특징
- `content-type: application/x-www-form-urlencoded`
- 메시지 바디에 쿼리 파라미터 형식으로 전달한다.
	- `username=hello&age=20`
### 사용법
- `application/x-www-form-urlencoded` 형식은 앞서 GET 쿼리 파라미터 형식과 같다. 따라서 쿼리 파라미터 조회 메서드를 그대로 사용하면 된다.
- 클라이언트(웹 브라우저) 입장에서는 두 방식에 차이가 있지만, 서버 입장에서는 둘의 형식이 동일하므로, `request.getParameter()` 로 편리하게 구분없이 조회할 수 있다.

> [!note] 참고사항
> `request.getParameter()` 는 GET URL 쿼리 파라미터 형식도 지원하고, POST HTML Form 형식도 둘 다 지원한다.

> [!note] 참고사항
> - `content-type`은 HTTP 메시지 바디의 데이터 형식을 지정한다.
> - **GET URL 쿼리 파라미터 형식**으로 클라이언트에서 서버로 데이터를 전달할 때는 HTTP 메시지 바디를 사용하지 않기 때문에 content-type이 없다.
> - **POST HTML Form 형식**으로 데이터를 전달하면 HTTP 메시지 바디에 해당 데이터를 포함해서 보내기 때문에 바디에 포함된 데이터가 어떤 형식인지 `content-type`을 꼭 지정해야 한다. 이렇게 폼으로 데이터를 전송하는 형식을 `application/x-www-form-urlencoded` 라 한다.

## 5) HTTP 요청 데이터 - API 메시지 바디 - 단순 텍스트
- HTTP message body에 데이터를 직접 담아서 요청하는 방식이다.
- HTTP API에서 주로 사용한다.
	- JSON, XML, TEXT
- 데이터 형식은 주로 JSON을 사용한다.
- POST, PUT, PATCH
### 사용법
- `request.getInputStream()`을 통해서 HTTP 메시지 바디의 데이터를 직접 읽을 수 있다.
	- 해당 메서드는 byte 코드를 반환하는데, 읽을 수 있는 문자(String)으로 보려면 문자표(Charset)를 지정해줘야한다.
	- 보통 `UTF_8`을 이용한다.

## 6) HTTP 요청 데이터 - API 메시지 바디 - JSON
- 보통 데이터를 JSON 형식으로 주고 받는다.
### JSON 형식 전송
- POST `http://localhost:8080/request-body-json`
- content-type: `application/json`
- message body: `{"username": "hello", "age": 20}`
- 결과: `messageBody = {"username": "hello", "age": 20}`
### JSON 형식 파싱 추가
- 보통 JSON을 그대로 쓰지 않고 객체로 파싱해가며 사용한다.
- JSON 형식으로 파싱할 수 있게 객체를 생성해줘야한다.
```java
package hello.servlet.basic;

import lombok.Getter;
import lombok.Setter;

@Getter @Setter
public class HelloData {
     private String username;
     private int age;
}
```
- JSON 결과를 파싱해서 사용할 수 있는 자바 객체로 변환하려면 Jackson, Gson 같은 JSON 변환 라이브러리를 추가해서 사용해야 한다. 스프링 부트로 Spring MVC를 선택하면 기본으로 Jackson 라이브러리 (`ObjectMapper`)를 함께 제공한다.

> [!note] 참고사항
> HTML Form 데이터도 메시지 바디를 통해 전송되므로 직접 읽을 수 있다. 하지만 편리한 파리미터 조회 기능 (`request.getParameter(...)`)을 이미 제공하기 때문에 파라미터 조회 기능을 사용하면 된다.

## 7) HttpServletResponse - 기본 사용법
### (1) `HttpServletResponse` 역할
- HTTP 응답 메시지를 생성한다.
	- HTTP 응답코드 지정
	- 헤더 생성
	- 바디 생성
- 편의 기능을 제공한다.
	- Content-Type 지정
	- 쿠키를 편리하게 객체로 생성하는 기능 제공
	- Redirect

### (2) Content-Type 편의 메서드
```java
private void content(HttpServletResponse response) {  
	//Content-Type: text/plain;
	//charset=utf-8
	//Content-Length: 2
	//response.setHeader("Content-Type", "text/plain;charset=utf-8");
	response.setContentType("text/plain");
	response.setCharacterEncoding("utf-8");
	response.setContentLength(2); //(생략시 자동 생성)
}
```

### (3) 쿠키 편의 메서드
```java
private void cookie(HttpServletResponse response) {  
	//Set-Cookie: myCookie=good;
	//Max-Age=600;
	//response.setHeader("Set-Cookie", "myCookie=good; Max-Age=600");
	Cookie cookie = new Cookie("myCookie", "good");
	cookie.setMaxAge(600); //600초
	response.addCookie(cookie);
}
```

### (4) redirect 편의 메서드
```java
 private void redirect(HttpServletResponse response) throws IOException {
     //Status Code 302
     // Location: /basic/hello-form.html
     //response.setStatus(HttpServletResponse.SC_FOUND); //302
     //response.setHeader("Location", "/basic/hello-form.html");
     response.sendRedirect("/basic/hello-form.html");
}
```

## 8) HTTP 응답 데이터 - 단순 텍스트, HTML, API JSON
- HTTP 응답 메시지는 주로 다음과 같은 내용을 담아서 전달한다.

1. 단순 텍스트 응답
	- `writer.println("ok");`
2. HTML 응답
	- HTTP 응답으로 HTML을 반환할 때는, content-type을 `text/html`로 지정해야 한다.
3. HTTP API - MessageBody JSON 응답
	- HTTP 응답으로 JSON을 반환할 때는 content-type을 `application/json` 로 지정해야 한다.
	- Jackson 라이브러리가 제공하는 `objectMapper.writeValueAsString()` 를 사용하면 객체를 JSON 문자로 변경할 수 있다.

> [!note] 참고사항
> - `application/json` 은 스펙상 utf-8 형식을 사용하도록 정의되어 있다. 그래서 스펙에서 charset=utf-8 과 같은 추가 파라미터를 지원하지 않는다.
> - 따라서 `application/json` 이라고만 사용해야지 `application/json;charset=utf-8` 이라고 전달하는 것은 의미 없는 파라미터를 추가한 것이 된다. 
> - response.getWriter()를 사용하면 추가 파라미터를 자동으로 추가해버린다. 이때는 response.getOutputStream()으로 출력하면 그런 문제가 없다.

