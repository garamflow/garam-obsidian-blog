## 1) 사전 준비
- Java 17 이상
- IDE : IntelliJ
- https://start.spring.io/
	- Gradle - Groovy
	- Spring boot : 3.x.x
	- Language : Java
	- Packaging : Jar
	- Java : 17 or 21
	- Dependencies : 설정 x

## 2) 비즈니스 요구사항과 설계
- 회원
	- 회원 가입 및 조회가 가능하다.
	- 회원은 일반과 VIP 등급이 있다.
	- 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템을 연동할 수 있다. (미확정)
- 주문과 할인 정책
	- 회원은 상품을 주문할 수 있다.
	- 회원 등급에 따라 할인 정책 적용할 수 있다.
	- 할인 정책은 모든 VIP는 1000원을 할인해주는 고정 금액 할인이다. (나중에 변경 가능)
	- 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고 오픈 직전까지 고민중이다. 할인을 적용하지 않을 수 있다. (미확정)

- 지금 현재 확정하기 어려운 부분들이 있지만 객체 지향 설계 방법을 이용한다.
- 인터페이스를 만들고 구현체를 언제든지 갈아끼울 수 있도록 설계한다.

## 3) 회원 도메인 설계
- 회원 도메인 요구사항	
	- 회원 가입 및 조회가 가능하다.
	- 회원은 일반과 VIP 등급이 있다.
	- 회원 데이터는 자체 DB를 구축할 수 있고, 외부 시스템을 연동할 수 있다. (미확정)


### 회원 도메인 협력 관계
- 현재 자체 DB를 사용할 지, 외부 시스템을 연동할 지 결정하지 않았으므로 메모리 회원 저장소를 간단하게 만들어서 개발용으로 사용할 것이다.
- 나중에 확정되면 구현체를 갈아끼우면 된다.

- 회원 도메인 협력 관계 (기획자와 함께)
![회원 도메인 협력 관계 (with 기획자)](/media/Spring/[김영한]%20스프링%20핵심%20원리%20-%20기본편/2/회원%20도메인%20협력%20관계%20(with%20기획자).png)

- 회원 클래스 다이어그램 (실제 구현 레벨, 개발자들이 구체화)
![회원 클래스 다이어그램 (실제 구현 레벨, 개발자들이 구체화)](/media/Spring/[김영한]%20스프링%20핵심%20원리%20-%20기본편/2/회원%20클래스%20다이어그램%20(실제%20구현%20레벨,%20개발자들이%20구체화).png)

- 회원 객체 다이어그램 (클라이언트가 실제 사용하는 유한 인스턴스 참조)
![회원 객체 다이어그램 (클라이언트가 실제 사용하는 유한 인스턴스 참조)](/media/Spring/[김영한]%20스프링%20핵심%20원리%20-%20기본편/2/회원%20객체%20다이어그램%20(클라이언트가%20실제%20사용하는%20유한%20인스턴스%20참조).png)
## 4) 회원 도메인 개발
```java
// src/main/java/hello.com/member/Grade
public enum Grade {
	BASIC,
	VIP
}

```

```java
// src/main/java/hello.com/member/Member
public class Member {
	private Long id;
	private String name;
	private Grade grade;

	// 생성자
	// Getter, Setter
}
```

```java
// src/main/java/hello.com/member/MemberRepository
public interface MemberRepository {
	void save(Member member);
	Member findById(Long memberId);
}
```
- 구현제와 인터페이스는 원래 분리해놓는게 좋다.

```java
// src/main/java/hello.com/member/MemoryMemberRepository
public class MemoryMemberRepository implements MemberRepository {
	private static Map<Long, Member> store = new HashMap<>();

	@Override
	public void save(Member member) {
		store.put(member.getId(), member);
	}

	@Override
	public Member findById(Long memberId) {
		return store.get(memberId);
	}
}
```
- 원래는 Concurrent 해쉬맵을 사용해야되지만 예제이므로 해쉬맵을 사용

```java
// src/main/java/hello.com/member/MemberService
public interface MemberService {
	void join(Member member);
	Member findMember(Long memberId);
}
```

```java
// src/main/java/hello.com/member/MemberServiceImpl
public class MemberServiceImpl implements MemberService {

	private final MemberRepository memberRepository = new MemmoryMemberRepository();

	@Override
	public void join(Member member) {
		memberRepository.save(member);
	}

	@Override
	public Member findMember(Long memberId) {
		return memberRepository.findById(memberId);
	}
}
```
- 구현제가 하나일 경우 ~Impl이라고 많이 쓴다.

## 5) 회원 도메인 실행과 테스트
```java
// src/main/java/hello.com/MemberApp
public class MemberApp {
	public static void main(String[] args) {
		MemberService memberService = new MemberServiceImpl();
		new Member(1L, "memberA", Grade.VIP);
		Member member = memberService.join(member);
		memberService.join(member);

		Member findMember = memberService.findMember(1L);
		System.out.println("new member = " + member.getName());
		System.out.println("find member = " + findMember.getName());
	}
}
```
- 위와 같은 순수 Java 코드만으로도 작동하는지 알아볼 수 있다.
- 하지만 좋은 방법은 아니기에 미리 세팅이 된 JUnit을 사용해서 테스트하자.

```java
// src/test/java/hello.core/member/MemberServiceTest
import org.junit.jupiter.api.Test;

public class MemberServiceTest {
	MemberService memberService = new MemberServiceImpl();
	
	@Test
	void join() {
	//given
	Member member = new Member(1L, "memberA", Grade.VIP);
	
	//when
	memberService.join(member);
	Member findMember = memberService.findMember(1L);
	
	//then
	Assertions.asserThat(member).isEqualTo(findMember);
	}
}
```

- 해당 코드의 설계상 문제점들이 있다.
	- OCP, DIP를 충족하는가?

## 6) 주문과 할인 도메인 설계
- 주문과 할인 정책
	- 회원은 상품을 주문할 수 있다.
	- 회원 등급에 따라 할인 정책 적용할 수 있다.
	- 할인 정책은 모든 VIP는 1000원을 할인해주는 고정 금액 할인이다. (나중에 변경 가능)
	- 할인 정책은 변경 가능성이 높다. 회사의 기본 할인 정책을 아직 정하지 못했고 오픈 직전까지 고민중이다. 할인을 적용하지 않을 수 있다. (미확정)

### 주문 도메인 협력, 역할, 책임


1. 주문 생성 : 클라이언트는 주문 서비스에 주문 생성을 요청한다.
2. 회원 조회 : 할인을 위해서는 회원 등급이 필요하다. 그래서 주문 서비스는 회원 저장소에서 회원을 조회한다.
3. 할인 적용 : 주문 서비스는 회원 등급에 따른 할인 여부를 할인 정책에 위임한다.
4. 주문 결과 반환 : 주문 서비스는 할인 결과를 포함한 주문 결과를 반환한다.
> 실제로는 주문 데이터를 DB에 저장하지만, 예제가 너무 복잡해지므로 단순 주문 결과를 반환한다.

#### 주문 도메인 전체
![주문 도메인 전체](/media/Spring/[김영한]%20스프링%20핵심%20원리%20-%20기본편/2/주문%20도메인%20전체.png)
- 역할과 구현을 분리해서 저장소와 할인 정책을 유연하게 변경할 수 있다.

#### 주문 도메인 클래스 다이어그램
![주문 도메인 클래스 다이어그램](/media/Spring/[김영한]%20스프링%20핵심%20원리%20-%20기본편/2/주문%20도메인%20클래스%20다이어그램.png)