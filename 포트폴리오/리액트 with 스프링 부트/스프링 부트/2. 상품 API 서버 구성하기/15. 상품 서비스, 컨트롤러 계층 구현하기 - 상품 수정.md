# 상품 서비스, 컨트롤러 계층 구현하기 - 상품 수정
## 1) 서비스 계층 - 인터페이스 - 상품 수정
```java
public interface ProductServiceTwo {
	...
    void modify(ProductDTOTwo productDTOTwo);
}
```

## 2) 서비스 계층 - 서비스 클래스 - 상품 수정
```java
public class ProductServiceTwoImpl implements ProductServiceTwo {
	...
	@Override
	public void modify(ProductDTOTwo productDTOTwo) {
	
	    // 조회
	    Optional<Product> result = productRepositoryTwo.findById(productDTOTwo.getPno());
	
	    Product product = result.orElseThrow();
	
	    // 변경 내용 반영
	    product.changePrice(productDTOTwo.getPrice());
	    product.changeDel(productDTOTwo.isDelFlag());
	    product.changeDesc(productDTOTwo.getPdesc());
	    product.changeName(productDTOTwo.getPname());
	
	    // 이미지 처리
	    List<String> uploadFileNames = productDTOTwo.getUploadedFileName();
	
	    product.clearList();
	
	    if(uploadFileNames != null && !uploadFileNames.isEmpty()) {
	        uploadFileNames.forEach(uploadName -> {
	            product.addImageString(uploadName);
	        });
	    }
	
	    // 저장
	    productRepositoryTwo.save(product);
	}
}
```

## 3) 컨트롤러 계층 - 상품 수정
```java
public class ProductControllerTwo {
	...
	@PutMapping("/{pno}")
	public Map<String, String> modify(@PathVariable("pno") Long pno, ProductDTOTwo productDTOTwo) {
	    productDTOTwo.setPno(pno);
	
	    // 예전에 저장되있던 파일
	    ProductDTOTwo oldProductDTOTwo = productServiceTwo.get(pno);
	
	    // 새롭데 업로드되는 파일
	    List<MultipartFile> files = productDTOTwo.getFiles();
	    List<String> currentUploadFileNames = fileUtil.saveFiles(files);
	
	    // 예전에 있었지만 지워지지 않은 파일들
	    List<String> uploadedFileNames = productDTOTwo.getUploadedFileName();
	
	    if(currentUploadFileNames != null && !currentUploadFileNames.isEmpty()) {
	        uploadedFileNames.addAll(currentUploadFileNames);
	    }
	
	    productServiceTwo.modify(productDTOTwo);
	
	    List<String> oldFileNames = oldProductDTOTwo.getUploadedFileName();
	    if(oldFileNames != null && !oldFileNames.isEmpty()) {
	        List<String> removeFiles =  
	        oldFileNames.stream()
	                .filter(fileName -> uploadedFileNames.indexOf(fileName) == -1)
	                .collect(Collectors.toList());
	
	        fileUtil.deleteFiles(removeFiles);
	    }
	    // 기존 파일은 저장되있고 데이터베이스에 존재
	
	    return Map.of("RESULT", "SUCCESS");
	}
}
```