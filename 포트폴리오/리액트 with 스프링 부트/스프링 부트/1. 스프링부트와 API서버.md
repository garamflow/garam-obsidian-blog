# 스프링부트와 API 서버
- 처음에 프로젝트를 만들면 에러가 난다.
- 왜냐하면 데이터베이스에 관한 설정을 추가해줘야되기 때문이다.

## 1) 데이터베이스 만들기 및 사용자 만들고 권한 주기
- 먼저 MySQL의 root 계정으로 접속해준다.
```mysql
create database shoppingmallapidb;  
  
create user 'apidbuser'@'localhost' identified by 'apidbuser';  
create user 'apidbuser'@'%' identified by 'apidbuser';  
  
grant all privileges on shoppingmallapidb.* to 'apidbuser'@'localhost';  
grant all privileges on shoppingmallapidb.* to 'apidbuser'@'%';
```
- 위와 같이 데이터베이스를 만들어주고 사용자를 만들고 권한을 설정해준다.
- IntelliJ에서 새로운 데이터 소스 만들기에 들어간다. (데이터 소스 및 드라이버)
	- 왼쪽 위 + 를 통해서 mysql 데이터 소스를 새롭게 만든다.
	- 데이터베이스를 shoppingmallapidb로 설정해준다.
	- 사용자는 위에서 만든 apidbuser와 비밀번호도 적어준다.
	- 테스트 후 적용-확인
- 데이터 베이스를 만들고서 `select now();`를 통해 현재 시간과 일치하는지 확인해줘야한다.

### application.yml 수정하기
```groovy
spring:  
  datasource:  
    url: "jdbc:mysql://localhost:3306/shoppingmallapidb"  
    username: "apidbuser"  
    password: "apidbuser"  
    driver-class-name: com.mysql.cj.jdbc.Driver  
  jpa:  
    hibernate:  
      ddl-auto: update  
    properties:  
      hibernate:  
        show_sql: true  
        format_sql: true  
        dialect: org.hibernate.dialect.MySQL8Dialect
```
- 스프링부트는 Hikaricp를 사용한다.
```shell
2024-02-06T12:26:11.997+09:00  INFO 24353 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2024-02-06T12:26:12.353+09:00  INFO 24353 --- [  restartedMain] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.mysql.cj.jdbc.ConnectionImpl@4485e6f8
2024-02-06T12:26:12.356+09:00  INFO 24353 --- [  restartedMain] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
```
- yml은 처음에 기본 설정을 잘 해줘야한다.
	- 위에 yml의 기본 설정은 커넥션풀이다.
		- 커넥션 풀: 커넥션을 미리 만들어주고 재사용하는 방식
	- 그런데 AWS를 사용하면 너무 많이 만들기 때문에 커넥션 풀의 초기 크기, 타임아웃을 설정해줘야한다.
		- 타임아웃 : SQL이 어느정도 시간이 지나도 동작을 안하면 버려버리게 한다.
- `ddl-auto`
	- 테이블이 없으면 만들어주고 있으면서 변경되면 alter로 테이블을 변경한다.

## 2) 엔티티 클래스 만들기
- 엔티티
	- 엔티티 클래스
		- 우리가 지금 만드는 것
	- 엔티티 객체
- 테이블을 먼저 만드는 경우가 있지만 JPA를 쓸 경우에는 엔티티를 먼저하는 걸 추천한다.
- 엔티티를 만들어주고 이제 레포지토리를 만들어준다.
- 그다음에는 테스트 코드를 만들어준다.
```java
package org.mall.shoppingmallapi.domain;  
  
import jakarta.persistence.Entity;  
import jakarta.persistence.GeneratedValue;  
import jakarta.persistence.GenerationType;  
import jakarta.persistence.Id;  
import lombok.*;  
  
import java.time.LocalDate;  
  
@Entity  
@ToString  
@Getter  
@Builder  
@AllArgsConstructor  
@NoArgsConstructor  
public class ProductEntity {  
  
    @Id  
    @GeneratedValue(strategy = GenerationType.IDENTITY)  
    private Long id;  
  
    private String name;  
    private String description;  
    private Double price;  
    private Integer stockQuantity;  
    private String ImageUrl;  
    private LocalDate uploadDate;  
}
```
## 3) 엔티티 테스트 코드
- 테스트 코드를 만들 때는 build.gradle의 dependencies에서 확인할 수 있는, lombok과 annotationProcessor에서 추가를 해줘야할게 있다.
```
dependencies {
	...
	testCompileOnly 'org.projectlombok:lombok'
	testAnnotationProcessor 'org.projectlombok:lombok'
}
```
- 위와 같이 작성해줘야 테스트할 시 log4j 등을 사용할 수 있다.
- repository를 테스트할 것이니, `test.org.mall.shoppingmallapi.repository` 패키지 내부에 repositor이름 + Tests 를 붙인 이름으로 클래스를 만들어준다.
- `@DataJpaTest` 등 좋은 테스트를 써도 되지만 `@SpringBootTest`와 `@Log4j2`를 통해 로그도 찍어볼 것이다.
```java

```