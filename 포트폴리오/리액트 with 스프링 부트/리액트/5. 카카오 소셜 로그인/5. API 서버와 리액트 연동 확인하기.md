# 5. API 서버와 리액트 연동 확인하기
## 1) 컨트롤러에서 결과 처리하기
- 일반 로그인과 카카오 로그인 전부 동일하게 JSON 데이터가 될수 있도록 처리해야한다.
- API 서버에 접근할 Access Token, Refresh Token을 발행해서 추가해준다.
```java
package org.mall.shoppingmallapi.controller;

import lombok.RequiredArgsConstructor;
import lombok.extern.log4j.Log4j2;
import org.mall.shoppingmallapi.dto.MemberDTO;
import org.mall.shoppingmallapi.service.MemberService;
import org.mall.shoppingmallapi.util.JWTUtil;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

import java.util.Map;

@RestController
@Log4j2
@RequiredArgsConstructor
public class SocialController {
    private final MemberService memberService;

    @GetMapping("/api/member/kakao")
    public Map<String, Object> getMemberFromKakao(String accessToken) {
        log.info("accessToken", accessToken);

        MemberDTO memberDTO = memberService.getKakaoMember(accessToken);

        Map<String, Object> claims = memberDTO.getClaims();

        String jwtAccessToken = JWTUtil.generateToken(claims, 10);
        String jwtRefreshToken = JWTUtil.generateToken(claims, 60*24);

        claims.put("accessToken", jwtAccessToken);
        claims.put("refreshToken", jwtRefreshToken);

        return claims;
    }
}
```

## 2) 리액트로 로그인 처리하기
- API 서버에서 보내준 데이터는 일반 로그인 데이터 구성과 동일하다.
- loginSlice의 login()을 이용할 수 있다.
```javascript
const loginSlice = createSlice({
  name: 'loginSlice',
  initialState: loadMemberCookie() || initState,
  reducers: {
    login: (state, action) => {
      console.log('login');
      setCookie("member", JSON.stringify(action.payload), 1);
      return action.payload;
    },
    ...
```

## 3) 소셜 로그인 시 화면 이동 처리하기
- 소셜 로그인하면 회원 정보를 수정할 수 있게 수정 페이지로 이동하게 만들어주고, 아니라면 메인 화면으로 이동하게 만들어준다.
```javascript
import React, { useEffect } from 'react';
import { useSearchParams } from 'react-router-dom';
import { getAccessToken, getMemberWithAccessToken } from '../../api/kakaoApi';
import { useDispatch } from 'react-redux';
import { login } from '../../slices/loginSlice';
import useCustomLogin from '../../hooks/useCustomLogin';

const KaKaoRedirectPage = () => {
  const [searchParams] = useSearchParams();
  const { moveToPath } = useCustomLogin();
  const authCode = searchParams.get('code');
  const dispatch = useDispatch();

  useEffect(() => {
    getAccessToken(authCode).then(accessToken => {
      getMemberWithAccessToken(accessToken).then(memberInfo => {
        console.log(memberInfo);
        dispatch(login(memberInfo));

        if (memberInfo && memberInfo.social) {
          moveToPath("/member/modify");
        } else {
          moveToPath("/");
        };
      });
    });
  }, [authCode]);


  return (
    <div>
      <div>KaKao Login Redirect</div>
      <div>{authCode}</div>
    </div>
  );
}

export default KaKaoRedirectPage;
```