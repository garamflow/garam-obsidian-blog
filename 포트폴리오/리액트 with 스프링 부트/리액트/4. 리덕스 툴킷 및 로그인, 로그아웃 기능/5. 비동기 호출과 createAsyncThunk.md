# 비동기 호출과 createAsyncThunk
- API 서버를 통해 로그인, 로그아웃을 처리하는 작업과 로그인 시 API 서버를 연동하는 처리가 필요하다.

## 1) 로그인 API 구현
```javascript
// src/api/memberApi.js

import axios from 'axios';
import { API_SERVER_HOST } from './productsApi';

const host = `${API_SERVER_HOST}/api/member`

export const loginPost = async (loginParam) => {
  const header = { headers: { "Content-Type": "x-www-form-urlencoded" } };

  const form = new FormData();
  form.append('username', loginParam.email);
  form.append('password', loginParam.password);
  const res = await axios.post(`${host}/login`, form, header);

  return res.data
};
```

## 2) 비동기 통신 상태에 따른 리듀서 구현
- `createAsyncThunk`를 이용해서 비동기 통신 상태에 따른 처리가 가능하다.
- `extraReducers`는 비동기 호출의 상태에 따라 작동하는 리듀서이다.
```javascript
import { createAsyncThunk, createSlice } from '@reduxjs/toolkit';
import { loginPost } from '../api/memberApi';

const initState = {
  email: ''
}

export const loginPostAsync = createAsyncThunk('loginPostAsync', (param) => loginPost(param));

const loginSlice = createSlice({
  name: 'loginSlice',
  initialState: initState,
  reducers: {
    login: (state, action) => {
      console.log('login');
      return { email: action.payload.email }
    },
    logout: () => {
      console.log('logout');
      return { ...initState }
    }
  },
  extraReducers: (builder) => {
    builder.addCase(loginPostAsync.fulfilled, (state, action) => {
      console.log('fulfilled');
      const payload = action.payload;
      return payload;
    })
      .addCase(loginPostAsync.pending, (state, action) => {
        console.log('pending');
      })
      .addCase(loginPostAsync.rejected, (state, action) => {
        console.log('rejected');
      })
  }
});

export const { login, logout } = loginSlice.actions;

export default loginSlice.reducer;
```

## 3) 로그인 컴포넌트의 동기화 호출을 비동기 호출로 변경
```javascript
const LoginComponent = () => {
	...
	const handleClickLogin = (e) => {
		dispatch(loginPostAsync(loginParam));
	};
	...
```