# 1-2. 프로세스
## 1) 프로세스와 스레드 (⭐⭐⭐)
### (1) 프로세스(process)
- OS가 메모리에 로드하여 실행 중인 프로그램을 의미한다.
- 프로세스는 OS로부터 독립된 메모리 영역을 할당받으며, 다른 프로세스의 메모리 영역에 접근할 수 없다.

#### 프로세스의 메모리 영역 구조
- 스택(stack): 지역 변수, 함수의 매개변수(parameter), 반환되는 주소 값 등이 저장되는 영역이다.
	- LIFO (Last In First Out, 후입선출) 방식으로, 높은 주소 값에서 낮은 주소 값 순서로 사용한다.
- 힙(heap): 사용자에 의해 동적 메모리 할당이 일어나는 영역이다.
	- FIFO (First In First Out, 선입선출) 방식으로, 낮은 주소 값에서 높은 주소 값 순서로 사용한다.
- 데이터(data): 전역 변수, 정적 변수, 배열, 구조체 등이 저장되는 영역이다.
- 코드(code): 실행할 코드가 기계어로 컴파일되어 저장되는 영역으로, 텍스트(text) 영역이라고도 한다.

- 스택과 힙 영역은 동적으로 메모리 할당이 가능해 두 영역 사이에 빈 메모리 공간이 존재한다.
- 메모리 영역을 공유하기 때문에 침범하는 문제가 생길 수 있다.
	- 스택 오버플로(stack overflow): 스택 영역이 힙 영역을 침범하는 경우
	- 힙 오버플로(heap overflow): 힙 영역이 스택 영역을 침범하는 경우
	- 오버플로(overflow): 메모리 공간에서 할당할 수 있는 최대 범위를 넘어가는 것을 의미한다.
	- 언더플로(underflow): 메모리 공간에서 할당할 수 있는 최소 범위보다 작은 것을 의미한다.

### (2) 스레드(thread)
- 스레드는 프로세스에서 실제로 실행되는 가장 작은 실행 단위를 말하며, 프로그램의 코드를 순차적으로 실행하는 데 사용된다.
- 프로세스 안에 존재하므로 지역 변수를 저장하는 스택 영역을 할당받는다.
- 전역 변수를 저장하는 힙 영역은 다른 스레드와 공유한다.

## 2) PCB (Process Control Block, 프로세스 제어 블록) (⭐⭐)
- OS가 프로세스를 제어하기 위해 프로세스 정보를 저장하는 것을 PCB라고 한다.
- PCB에 저장되는 정리하는 내용은 아래와 같다.
	- 프로세스의 현재 상태
	- 프로세스를 나타내는 고유의 PID (Process ID)
	- 부모 프로세스의 PID
	- 자식 프로세스의 PID
	- 다음 실행할 명령어의 주소인 PC (Program Counter, 프로그램 카운터)
	- 프로세스의 우선 순위
	- 메모리 제한
	- ...

## 3) 프로세스의 생성 (⭐⭐⭐)
- 새로운 프로세스는 기존 프로세스에서 `fork()` 함수를 호출해 생성한다.
- `fork()` 함수에는 함수를 호출한 프로세스를 복사한다.
	- 기존 프로세스를 부모(parent) 프로세스, 복사된 프로세스를 자식(child) 프로세스라고 한다.
- 부모 프로세스에서 `fork()` 함수를 호출하면 부모 프로세스는 자식 프로세스 PID 값을, 자식 프로세스는 0을 반환한다.

## 4) 프로세스 상태도 (⭐⭐⭐)
- 프로세스는 CPU에 의해 생성되고 소멸하는 과정을 거친다.
- 프로세스는 생성되고 소멸하면서 생성(new), 준비(ready), 대기(waiting), 실행(running), 종료(terminated) 5가지 상태로 존재한다.
	- 생성(new): 프로세스 PCB를 가지고 있지만 OS로부터 승인(admit)받기 전
	- 준비(ready): OS로부터 승인받은 후 준비 큐에서 CPU 할당을 기다림
	- 대기(waiting): 프로세스가 CPU를 할당받아 실행함
	- 실행(running): 프로세스가 입출력이나 이벤트 발생을 기다려야 해서 CPU 사용을 멈추고 기다림
	- 종료(terminated): 프로세스 실행을 종료함
- 프로세스는 한 상태에서 다른 상태에서 다음과 같이 변화한다.
	- 생성 > 준비: 생성 상태의 프로세스가 OS로부터 승인을 받아, 준비 상태의 프로세스가 모여 있는 자료구조인 준비 큐(ready queue)에 추가됨
	- 준비 > 실행: 준비 큐에 있는 프로세스 중 우선순위가 높은 프로세스가 디스패치(dispatch)되어 실행됨
	- 실행 > 준비: CPU 독점을 방지하기 위해 타임아웃(timeout)되어 준비 상태로 변경됨
	- 실행 > 대기: 입출력 또는 이벤트 때문에 대기 상태로 변경됨
	- 대기 > 준비: 입출력 또는 이벤트가 완료되어 준비 상태로 변경됨
	- 실행 > 종료: 실행 중인 프로세스가 정상적으로 끝나서 종료 상태로 변경됨

> [!note] 용어사전
> 승인(admit): CPU를 제외한 다른 자원이 준비되어 해당 프로세스가 준비 상태가 될 수 있도록 OS가 허락하는 것을 의미한다.
> 디스패치(dispatch): 프로세스에 CPU 자원을 할당해 해당 프로세스가 준비 상태에서 실행 상태가 되는 것을 의미한다.

## 5) 멀티 프로세스와 멀티 스레드 (⭐⭐⭐)
- **동시성(concurrency)** 은 하나의 코어(싱글 코어어에서 여러 작업을 번갈아 가면서 처리하는 방식이다.
	- CPU는 한 번에 하나의 작업만 처리할 수 있어서 여러 작업을 조금씩 돌아가면서 처리한다.
	- 하나의 CPU에서 여러 작업을 번갈아 가면서 처리하기 위해 처리 중인 작업을 교체하는 것을 **콘텍스트 스위칭(context switching)** 이라 한다.
- **병렬성(parallelism)** 은 CPU가 여러 개(멀티 코어) 있어서 각 CPU에서 각 작업을 동시에 처리하는 방식이다.

### (1) 멀티 프로세스(multi process)
- 응용 프로그램 하나를 여러 개의 독립적인 프로세스로 구성하는 것을 의미한다.
- 프로세스 하나가 죽어도 다른 프로세스에 영향을 주지 않아서 여러 개로 구성하는 것이 안정적이다.
- 시간과 메모리 공간을 많이 사용한다는 단점이 있다.
	- 여러 프로세스를 처리하려면 콘텍스트 스위칭 작업이 이루어져야 하는데, CPU에서 기존에 처리하던 프로세스가 할당받은 메모리 영역을 다른 프로세스에서 사용할 수 있게 교체하면서 시간과 메모리가 필요하다. 이것을은 오버헤드(overhead)라고 한다.
- 프로세스는 독립적인 메모리를 할당받는데, 프로세스 간에 공유한 자원이 있다면 IPC (Inter Process Communication)를 통해 프로세스 간에 자원을 공유해야 한다.
	- 공유할 메모리를 직접 참조하는 것보다 비효율적이다.

### (2) 멀티 스레드(multi thread)
- 하나의 응용 프로그램 내에서 여러 개의 스레드를 동시에 실행시켜 각자 다른 작업을 처리해서 자원의 사용을 최적화하고 실행 효율을 높이는 기술이다.
- 멀티 스레드는 스레드 간에 힙, 데이터, 코드 영역을 공유한다.
	- 콘텍스트 스위칭할 때 오버헤드가 적게 발생하고 IPC를 사용하지 않아도 되어 멀티 프로세스 단점을 보완할 수 있다.
	- 따라서 독립적인 메모리 공간을 갖는 프로세스를 여러 개 생성하는 것보다 스레드를 여러 개 생성하는 것이 자원을 효율적으로 사용할 수 있다.
- 스레드 간 자원 공유가 프로세스 간 자원 공유보다 시스템 처리 비용이 적고 프로그램 응답 시간도 단축된다.
- 스택 영역을 다른 스레드와 함께 사용하므로 공유 자원에 대한 동기화가 필수적이다.
	- 스레드에 문제가 생기면 프로세스 내 다른 스레드에 영향을 미칠 수 있다.

## 6) 콘텍스트 스위칭(context switching) (⭐⭐⭐)
- 멀티 프로세스 환경에서 CPU가 처리 중인 프로세스의 정보를 바꾸는 것을 말한다.
- CPU에서 프로세스를 처리하다가 입출력 관련 이벤트 혹은 예외 상황이 발생할 때 이에 대응할 수 있게 CPU에 처리를 요청하는 것을 **인터럽트(interrupt)** 하고 한다.
	- 입출력이 발생할 때
	- CPU 사용 시간이 만료되었을 때
	- 자식 프로세스를 생성할 때
- **콘텍스트(context)** 는 CPU가 처리하는 프로세스의 정보를 의미한다.
- CPU에서 처리 중인 프로세스가 중간에 변경되어도 PCB에 의해 이전에 실행한 명령어의 주소 값이 무엇인지, 데이터가 스택에 어디까지 채워져 있는지 알고 있어서 콘텍스트 스위칭이 이뤄진다.
	- PCB에 프로그램 카운터(PC, Program Counter)와 스택 포인터(stack pointer)가 저장되어 있어서 이다.
		- 프로그램 카운터: 프로세스가 이어서 처리해야 하는 명령어의 주소 값
		- 스택 포인터: 스택 영역에서 데이터가 채워진 가장 높은 주소 값

## 7) 프로세스 동기화 (⭐⭐⭐)
### (1) 경쟁 상태(race condition)
- 하나의 공유 자원에 프로세스 또는 스레드에서 접근하는 경유 경재하는 상태를 말한다.
	- 예시) 너무 많은 우유 문제(too much milk problem)가 있다.
	- 이런 문제를 해결하려면 프로세스 동기화가 이뤄져야 한다.

### (2) 임계 영역(critical section)
- 공유 자원에 접근할 수 있고 접근 순서에 따라 결과가 달라지는 코드 영역을 말한다.
- 임계 영역에 여러 접근이 동시에 발생하는 것을 발생하려면 아래 3가지 조건이 충족해야 한다.
	- 상호배제 기법(mutual exclusive): 어떤 프로세스가 임계 영역을 실행 중일 때 다른 프로세스가 임계 영역에 접근할 수 없다.
	- 진행(progress): 임계 영역을 실행 중인 프로세스가 없을 때 다른 프로세스가 임계 영역을 실행한다.
	- 한정된 대기(bounded waiting): 임계 영역에 접근을 욫어했을 때 무한한 시간을 기다리지 않는다.

### (3) 뮤텍스(mutex)
- 락(lock)을 가진 프로세스만이 공유 자원에 접근할 수 있게 하는 방법이다.
- 임계 영역에 먼저 접근한 프로세스가 임계 영역에 락을 걸면 다른 프로세스들은 해당 프로세스가 락을 해제하기 전까지 대기해야 한다.
	- 락킹 메커니즘(locking mechanism)이라고도 한다.
	- 접근 못한 프로세스는 반복문을 돌면서 확인하는데, 이를 바쁜 대기(busy waiting)의 한 종류인 스핀락(spinlock)이라고 한다.

### (4) 세마포터(semaphore)
- 공유 자원에 접근할 수 있는 프로세스의 수를 정해 접근을 제어하는 방법이다.
- 공유 자원에 접근한 프로세스가 접근을 해제하면 다른 프로세스가 접근할 수 있도록 신호는 보낸다고 해서 시그널링 메커니즘(signaling mechanism)이라고도 한다.

> [!note] 용어사전
> - 동기(synchronization): 여러 작업을 처리할 때 작업 순서를 보장한다.
> - 비동기(asynchronization): 여러 작업을 처리할 때 작업 순서를 보장하지 않는다.
> - 블로킹(blocking): 작업을 수행할 때 대기할 수 있다는 것을 의마하며 작업 순서를 보장하지 않는다.
> - 넌블로킹(non-blocking): 작업을 시작하면 대기 없이 수행한다는 것을 의마한다.

## 8) 교착 상태(deadlock) (⭐⭐⭐)
- 2개 이상의 프로세스가 각각 자원을 가지고 있으면서 서로의 자원을 요구하며 기다리는 상태를 말한다.
- 