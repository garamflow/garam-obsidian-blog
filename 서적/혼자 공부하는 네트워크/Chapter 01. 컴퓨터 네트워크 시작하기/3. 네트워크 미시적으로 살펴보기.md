# 3. 네트워크 미시적으로 살펴보기
## 3.0 시작하기 전에
- 통신 과정에서 정보를 올바르게 주고받기 위해 합의된 규칙이나 방법을 의미하는 **프로토콜**
- 통신이 일어나는 구조를 계층화한 **네트워크 참조 모델**
- 통신 과정에서 이루어지는 **캡슐화(역캡슐화)**

## 3.1 프로토콜(Protocol)
- 호스트 간 패킷 교환하는 방식으로 대부분 **패킷 교환** 방식을 사용한다.
	- 택배로 비유했을 때, 수신지, 수신자, 발송자 등 정보가 택배 기사가 이해할 수 없으면 안되며, 택배 기사끼리 주고 받는 언어도 서로 통해야 한다.
- **프로토콜**은 노드 간 정보를 올바르게 주고받기 위해 합의된 규칙이나 방법을 의미한다.
	- 서로 다른 통신 장치가 정보를 주고받으려면 프로토콜이 통해야한다.
- 모든 프로토콜은 저마다의 **목적**과 **특징**이 있다.
	- 프로토콜마다 패킷의 헤더 내용이 달라질 수 있다. (없을 수도 있다.)

## 3.2 네트워크 참조 모델(Network Reference Model)
- 네트워크도 택배와 같이 정ㅂ를 주고받을 때 정형화된 여러 단계를 거친다.
- 이 과정을 계층으로 표현할 수 있는데 이를 **네트워크 참조 모델**이라 한다.
	- 계층으로 표현하므로 네트워크 계층 모델이라고도 부른다.

### 3.2.1 계층으로 나눈 이유 1 - 네트워크 구성과 설계가 용이하다.
- 각 계층이 수행해야 하는 역할이 정해져 있으니 계층 목적에 맞게 프로토콜과 네트워크 장비를 구성할 수 있다.
	- 단, 계층과 장비가 칼로 자르듯 명확하게 구분되지 않을 수 있다.
	- 네트워크 장비는 상위 계층의 장비가 하위 계층의 장비 역할을 포괄해서 수행하는 경우도 많다.
- 네트워크 구성 및 설계에 훌륭한 가이드라인 역할을 수행한다.

### 3.2.2 계층으로 나눈 이유 2 - 네트워크 문제 진단과 해결이 용이하다.
- 통신 과정 중 문제가 발생해도 원인을 계층별로 진단하기 수월하다.
- 계층별로 진단하면 문제 발생 지점을 추측할 수 있어서 해결이 수월하다.

### 3.2.3 OSI 모델
- **OSI 모델**은 국제 표준화 기구에서 만든 네트워크 참조 모델이다.

#### 1. 물리 계층(Physical Layer)
- OSI 모델의 최하단에 있는 계층으로, 1과 0으로 표현되는 비트 신호를 주고 받는 계층이다.
- 1과 0으로 표현된 비트 데이터는 다양한 통신 매체를 통해 다양한 신호로 운반된다.
- 통신 매체에 맞는 신호로 운반되도록 비트 데이터의 변환이 이루어지고 통신 매체를 통한 송수신이 이루어지는 계층이다.
- 주로 네트워크 장비, 통신 매체에 관한 이야기와 관련 있다.

#### 2. 데이터 링크 계층(Data Link Layer)
- 네트워크 내 주변 장치 간 정보를 올바르게 주고받기 위한 계층이다.
- 이더넷과 같은 LAN 기술이 데이터 링크 계층에 녹아있다.
- 물리 계층을 통해 주고받는 정보에 오류가 없는지 확인하고, MAC 주소라는 주소 체계를 통해 네트워크 내 송수신지를 특정할 수 있다.
- 전송 과정에서 발생하는 충돌 문제를 해결하는 계층이기도 하다.

#### 3. 네트워크 계층(Network Layer)
- 메시지를 다른 네트워크에 속한 수신지까지 전달하는 계층이다.
	- 네트워크 간 통신이 이루어진다.
- 인터넷을 가능하게 하는 계층으로 IP 주소라는 주소 체계를 통해 통신하고자 하는 수신지 호스트와 네트워크를 식별하고, 원하는 수신지에 도달하기 위한 최적 경로를 결정한다.

#### 4. 전송 계층(Transport Layer)
- 신뢰성 있고 안정성 있는 전송을 해야 할 때 필요한 계층이다.
	- 패킷이 정상적으로 보내졌는지와 중간에 유실된 정보는 없는지, 여러 개의 패킷을 보낼 때 순서가 뒤바뀐 것은 없는지 등을 확인해야 할 때가 있다.
	- 이때 패킷의 흐름을 제어하거나 전송 오류를 점검해 신뢰성 있고 안정적인 전송이 이루어지도록 한다.
- 포트라는 정보를 통해 시행 중인 응용 프로그램의 식별이 이루어진다.

#### 5. 세션 계층(Session Layer)
- 세션을 관리하기 위해 존재하는 계층이다.
	- 세션은 일반적으로 통신을 주고받는 호스트의 응용 프로그램 간 연결 상태를 의미한다.
- 이런 연결 상태를 생성, 유지하고 종료 시 끊어 주는 역할을 담당한다.

#### 6. 표현 계층(Presentation Layer)
- 번역기와 같은 역할을 하는 계층이다.
- 사람이 이해하는 언어 문자를 컴퓨터가 이해하는 코드로 변환하거나, 압축, 암호화하는 작업이 이루어진다.

#### 7. 응용 계층(Applicaiton Layer)
- 사용자 및 사용자가 이용하는 응용 프로그램과 가장 밀접히 맞닿아 있는 계층이다.
- 응용 프로그램에 다양한 네트워크 서비스를 제공한다.
	- 웹 브라우저 프로그램에 웹 페이지를 제공
	- 이메일 클라이언트 프로그램에 송수신된 이메일을 제공

### 3.2.4 TCP/IP 모델
- OSI 모델은 주로 네트워크를 이론적으로 기술하고 이해할 때 사용하고, TCP/IP 모델은 이론보다는 구현에 중점을 둔 네트워크 참조 모델이다.
	- 목적이 실용적 구현에 가깝다.
- TCP/IP 4계층, 인터넷 프로토콜 스위트, TCP/IP 프로토콜 스택이라고도 부른다.
	- IP는 인터넷 프로토콜(Internet Protocol)의 약자이다.
- 오늘날 네트워크 구현의 핵심이라서 TCP/IP라는 프로토콜 이름이 붙었다.

#### 1. 네트워크 액세스 계층(Network Access Layer)
- 링크 계층(Link Layer) 또는 네트워크 인터페이스 계층(Network Interface Layer)라고도 부른다.
- OSI 모델의 데이터 링크 계층과 유사하다.
- TCP/IP 모델에 물리 계층을 추가해서 5계층으로 확장하여 기술하기도 한다.

#### 2. 인터넷 계층(Internet Layer)
- OSI 모델에서 네트워크 계층과 유사하다.

#### 3. 전송 계층(Transport Layer)
- OSI 모델에서 전송 계층과 유사하다.

#### 4. 응용 계층(Application Layer)
- OSI 모델의 세션, 표현, 응용 계층을 합친 것과 유사하다.

![OSI 모델, TCP-IP모델](/media/서적/혼자%20공부하는%20네트워크/Chapter%2001.%20컴퓨터%20네트워크%20시작하기/OSI%20모델,%20TCP-IP모델.png)


## 3.3 캡슐화와 역캡슐화
- 패킷은 송신 과정에서 **캡슐화**가 이루어지고, 수신 과정에서 **역캡슐화**가 이루어진다.
- 네트워크 참조 모델도 송수신하는 메시지는 송신지 입장에서는 가장 높은 계층에서부터 가장 낮은 계층으로 이동하고, 수신지 입장에서는 가장 낮은 계층에서부터 가장 높은 계층으로 이동한다.

### 3.3.1 캡슐화
- 패킷 교환 네트워크에서 메시지는 패킷 단위로 송수신되는데, 택배와 비슷한 개념이다.
	- 패킷
		- 헤더와 페이로드, 때로는 트레일러를 포함한다.
		- 프로토콜의 목적과 특징에 따라 헤더 내용이 달라진다.
- 정보 수신 시 각 계층에서 상위 계층으로부터 내려받은 패킷을 페이로드로 삼아, 프로토콜에 걸맞은 헤더를 덧붙인 후 하위 계층으로 전달한다.
	- 데이터 링크 계층을 지날 때는 오류 감지를 위한 트레일러도 붙는다.
	- 상위 계층 패킷은 하위 계층에서 페이로드로 간주된다.
- 송신 과정에서 헤더 및 트레일러를 추가해 나가는 과정이 **캡슐화**(encapsulation) 혹은 **인캡슐레이션**이라고 부른다.

![캡슐화 과정](/media/서적/혼자%20공부하는%20네트워크/Chapter%2001.%20컴퓨터%20네트워크%20시작하기/캡슐화%20과정.png)

### 3.3.2 역캡슐화
- 역캡슐화는 받는 입장에서 생각해 보면 된다.
- 어떤 메시지를 수신할 때는 캡슐화 과정에서 붙였던 헤더를 각 계층에서 확인한 뒤 제거하는 것은 **역캡슐화**(decapsulation) 또는 **디캡슐레이션**라고 한다.

![역캡슐화 과정](/media/서적/혼자%20공부하는%20네트워크/Chapter%2001.%20컴퓨터%20네트워크%20시작하기/역캡슐화%20과정.png)

## 3.4 PDU (Protocol Data Unit)
- 각 계층에서 송수신되는 메시지의 단위를 PDU라고 한다.
- 상위 계층에서 전달받은 데이터에 현재 계층의 프로토콜 헤더(및 트레일러)를 추가하면 현재 계층의 PDU가 된다.
- 전송 계층보다 높은 계층에서는 일반적으로 데이터 혹은 메시지로만 지칭하고, 이하의에서는 메시지를 구분하게 된다.
	- 전송 계층에서는 TCP 프로토콜 사용 시 세그먼트, UDP 프로토콜 사용 시 데이터그램이다.
 
![PDU](/media/서적/혼자%20공부하는%20네트워크/Chapter%2001.%20컴퓨터%20네트워크%20시작하기/PDU.png)

![캡슐화, 역캡슐화, PDU 종합](/media/서적/혼자%20공부하는%20네트워크/Chapter%2001.%20컴퓨터%20네트워크%20시작하기/캡슐화,%20역캡슐화,%20PDU%20종합.png)

## 3.5 트래픽과 네트워크 성능 지표
- **트래픽**(traffic)이란 네트워크 내의 정보량을 의미한다.
	- 라우터에 트래픽이 몰린다
	- 서버의 트래픽을 분산한다.
- 특정 노드에 트래픽이 몰린다는 것은 해당 노드가 특정 시간 동안 처리할 정보가 많음을 의미하고, 이런 경우 노드에 **과부하**(overhead)가 생길 수 있다.
	- 성능 저하가 생길 수 있다.

### 3.5.1 처리율(throughput)
- 단위 시간당 네트워크를 통해 실제로 전송되는 정보량을 의미한다.
- bps(bit/s), Mbps(Mbit/s), Gbps(Gbit/s), pps(p/s) 단위로 표현한다.
- 실시간이 강조된 지표로, 특정 노드가 얼마만큼의 트래픽을 처리하는 중인지 판단하기 위해 사용된다.
	- 처리율이 매 순간 변하는 모습으로 표현되거나 평균값이 주로 활용된다.

### 3.5.2 대역폭(bandwidth)
- 