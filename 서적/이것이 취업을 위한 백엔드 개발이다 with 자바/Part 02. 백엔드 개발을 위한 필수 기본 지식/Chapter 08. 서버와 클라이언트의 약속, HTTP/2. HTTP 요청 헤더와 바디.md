# 2. HTTP 요청 헤더와 바디
## 1) HTTP 요청 살펴보기

![HTTP 요청 헤더 예시](/media/서적/이것이%20취업을%20위한%20백엔드%20개발이다%20with%20자바/Part%2002.%20백엔드%20개발을%20위한%20필수%20기본%20지식/Chapter%2008.%20서버와%20클라이언트의%20약속,%20HTTP/HTTP%20요청%20헤더%20예시.png)

- HTTP 요청은 크게 헤더와 바디로 나뉘고, 헤더는 첫 번째 줄과 나머지 줄로 나눌 수 있다.
- HTTP 요청 헤더의 첫 번째 줄
	- `GET /backend.html HTTP/1.1`
	- `GET`은 HTTP 요청 메서드로 GET을 사용했다는 의미이다.
	- `/backend.html` 은 해당 요청이 어떤 경로로 가는지를 나타낸다.
	- `HTTP/1.1` 은 해당 요청 HTTP 버전을 의미한다.

## 2) HTTP 요청 메서드들
### (1) 행위별로 적절한 HTTP 메서드 연결하기
- GET: 특정 자원에 대한 조회를 요청하는 메서드
- HEAD: GET 메서드에 대한 요청과 동일한 효과이지만, 바디를 제외한 헤더 부분만 응답으로 받는 메서드
- POST: 새로운 자원 생성을 요청하는 메서드. 새로운 자원은 요청 바디에 있는 내용을 바탕으로 생성된다.
- PUT: 기존에 있던 자원을 요청 바디에 있는 내용으로 변경하는 메서드
- PATCH: PUT처럼 기존 자원을 변경하지만, 해당 자원의 전체를 변경하는 게 아니라 일부만 변경된다.
- DELETE: 특정 자원을 제거한다.
- OPTIONS: 해당 경로에서 어떤 HTTP 요청 메서드를 사용할 수 있는지 알려준다.

### (2) 안전한 메서드와 멱득성 있는 메서드
#### 안전한 메서드
- 대상이 되는 자원의 상태를 변경하지 않는 메서드라는 의미이다.
- GET, HEAD, OPTIONS가 해당된다.
	- HEAD, OPTIONS는 `@RequestMapping` 을 추가해 줄 필요 없다.
	- GET 메서드로 `@RequestMapping` 해주면 WAS가 자동으로 생성해준다.
- GET 메서드 API도 안전한 메서드로 만들어야 한다.
	- 자원의 상태를 변경하지 않아야 한다.

#### 멱등성 있는 메서드
- 멱등성이란 한 번 호출한 것과 여러 번 호출한 것이 같은 자원의 상태를 가지는 것을 의미한다.
- POST는 대표적인 멱등성이 없는 메서드이다.
- 멱등성이 있는 메서드는 GET, PUT, DELETE가 있다.
	- PATCH 역시 멱등성이 없는 메서드이다.

#### 각각의 기능과 메서드 대응 이유
- 생성하기(POST): 생성하기는 멱등성이 없으므로 POST 메서드가 적절하다.
- 읽기(GET): 읽기 연산은 안전해야 하므로 GET 메서드가 적절하다.
- 수정하기(PUT): 수정하기는 보통 멱등성이 있다. 동일한 내용으로 요청해도 한 번 수정된 후 동일한 상태를 가지기 때문이다. 자원의 일부만 수정하는 기능이면서 멱등성이 없다면 PATCH를 고려해 볼 수 있다.
- 삭제하기(DELETE): 삭제하기는 보통 멱등성이 있다. 데이터베이스에 있는 자원의 고유한 ID를 기준으로 삭제를 요청하면, 한 번 삭제된 후 동일하게 자원이 삭제된 상태를 유지하게 된다.

#### GET은 반드시 안전한 메서드여야 한다.
- 자원의 상태를 변경하지 않아야 한다.

#### PUT, DELETE는 멱등성이 있는 메서드여야 한다.
- 한 번 호출한 것과 여러 번 호출한 것의 자원 상태가 같아야만 한다.
- 만약 멱등성이 없다면 PUT, DELETE가 아니라 POST 같은 메서드를 붙여야 한다.

### (3) HEAD와 OPTIONS 메서드
- HEAD 메서드를 사용하면 GET 메서드를 호출했을 때와 동일하지만, 응답 바디는 비어 있다.
- 예를 들어, 한 번 다운로드 된 페이지는 변경되기 전까지 다시 다운로드 하지 않는다는 규칙을 적용하는 크롤러(crawler)가 있을 때, HEAD 메서드를 사용할 수 있다.
	- HTTP 응답 헤더에 보면 `Last-Modified` 라는 헤더를 볼 수 있다옛
- HEAD 사용 예시
	1. 처음에는 GET으로 요청하고, 해당 웹 페이지의 URL, `Last-Modified` 헤더 값을 저장한다.
	2. 일정 주기 이후 웹 페이지가 변경되었는지 HEAD로 요청해서, `Last-Modified`가 변경되었는지 확인한다.
	3. 변경되었다면 GET 메서드로 요청해서 다시 다운로드하고, 아니면 다시 다운로드 할 필요가 없다.
- OPTIONS는 해당 경로로 어떤 HTTP 메서드 요청이 가능한 지 알 수 있다.
	- OPTIONS로 요청 후, 응답으로 온 HTTP 헤더의 `Allow` 항목에 어떤 HTTP 메서드 요청이 가능한 지 알 수 있다.


## 3) HTTP 요청 바디와 데이터 전달 방식
- HTTP 요청 바디는 HTTP 요청 시 데이터를 전달하는 방법에 대한 이야기이다.

### (1) URL을 통한 데이터 전달
#### 쿼리 파라미터
```
https://www.google.com/search?q=HTTP+Request&new...
```
- URL의 일부로 데이터를 전송하는 방식은 **쿼리 파라미터(query parameter)** 혹은 **쿼리 스트링(query string)** 이라고 한다.
	- 쿼리 파라미터로 보낸 데이터를 컨트롤러 쪽에서 활용할 때는 form가 동일하게 `@RequestParam`을 사용하면 된다.
- 쿼리 파라미터는 단순 URL 링크만으로 데이터를 전달할 수 있다.
- 쿼리 파라미터의 키(key)와 값(value)는 '='로 구분되어 있고, 여러 개를 전달할 때는 `&`로 묶인다.
- URL 인코딩(encoding)에 의해, URL에 사용하는 값 중 띄어쓰기나 특정 문자열, 아스키 코드(ascii code)외의 문자를 다른 형태로 인코딩해준다.
- 쿼리 파라미터의 경우 특정 자원 지칭보다는 필터의 조건이나 정렬 방식 등을 지정하는 경우가 많다.

![쿼리 파라미터를 통한 HTTP 요청 헤더와 바디](/media/서적/이것이%20취업을%20위한%20백엔드%20개발이다%20with%20자바/Part%2002.%20백엔드%20개발을%20위한%20필수%20기본%20지식/Chapter%2008.%20서버와%20클라이언트의%20약속,%20HTTP/쿼리%20파라미터를%20통한%20HTTP%20요청%20헤더와%20바디.png)

#### 패스 베리어블
- 쿼리 파라미터 외에도 데이터를 경로(path)의 일부인 패스 베리어블(path variable)로 전달하는 방법도 있다.
	- `/articles/123`
	- = `/articles?id=123`
- 일반적으로 패스 베리어블이 특정 자원(resource) 그 자체를 지칭할 때 사용한다.


### (2) 요청 바디를 통한 데이터 전달
- 중간 비어 있는 줄을 기준으로 위쪽이 헤더, 아래쪽이 바디이다.

#### `application/x-www-form-urlencoded` 로 요청 시
![application x-www-form-urlencoded를 사용한 HTTP 요청 헤더와 바디](/media/서적/이것이%20취업을%20위한%20백엔드%20개발이다%20with%20자바/Part%2002.%20백엔드%20개발을%20위한%20필수%20기본%20지식/Chapter%2008.%20서버와%20클라이언트의%20약속,%20HTTP/application%20x-www-form-urlencoded를%20사용한%20HTTP%20요청%20헤더와%20바디.png)
- 어디까지가 헤더이고 어디부터 바디인지 명확히 구분 가능하다.
- 인코딩이 되어 있다.

#### `multipart/form-data` 로 요청 시
![multipart form-data를 사용한 HTTP 요청 헤더와 바디](/media/서적/이것이%20취업을%20위한%20백엔드%20개발이다%20with%20자바/Part%2002.%20백엔드%20개발을%20위한%20필수%20기본%20지식/Chapter%2008.%20서버와%20클라이언트의%20약속,%20HTTP/multipart%20form-data를%20사용한%20HTTP%20요청%20헤더와%20바디.png)
- 바디 부분은 동일하지만, 각 데이터를 나누는 문자열이 헤더에 포함되어 있다.

#### `application/json` 로 요청 시
![application json을 사용한 HTTP 요청 헤더와 바디](/media/서적/이것이%20취업을%20위한%20백엔드%20개발이다%20with%20자바/Part%2002.%20백엔드%20개발을%20위한%20필수%20기본%20지식/Chapter%2008.%20서버와%20클라이언트의%20약속,%20HTTP/application%20json을%20사용한%20HTTP%20요청%20헤더와%20바디.png)
- 컨트롤러에서는 `@RequestBody` 를 통해 받을 수 있다.

### (3) HTTP 요청 시 데이터 전달 방식에서 주의점
#### GET 메서드와 HTTP 요청 바디
- GET 메서드로 데이터 요청 시, 요청 바디에 데이터를 넣는 것을 권장하지 않는다.
- 컨트롤러에서 GET 메서드로 지정한 `@RequestMapping` 에서 HTTP 요청 바디에 있는 데이터를 꺼낼수 있지만, 권장 방식이 아니다.

#### Content-Type 헤더
- Content-Type 헤더는 HTTP 요청과 응답 양쪽 헤더에 포함된다.
- 해당 HTTP 요청과 응답 바디에 포함된 데이터가 어떤 타입인지를 표현한다.
- 웹 브라우저는 서버에서 보내 준 Content-Type을 기준으로 바디를 파싱해서 보여 준다.

> Content-Type과 MIME 타입
> - `text-html` 이나 `application/json` 같은 문자열을 MIME 타입 혹은 미디어 타입(media type)이라고 한다.
> - MIME 타입은 크롤러 예시처럼 HEAD 메서드와 함께 사용하여 특정한 종류의 자원만 수집하는 것에 활용할 수 있다.