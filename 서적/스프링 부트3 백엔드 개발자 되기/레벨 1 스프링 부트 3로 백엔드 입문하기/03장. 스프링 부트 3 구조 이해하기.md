# 03장. 스프링 부트 3 구조 이해하기
## 3.1 스프링 부트 3 구조 살펴보기
- 스프링 부트는 각 계층이 양 옆 계층과 통신하는 구조를 따른다.
	- 계층은 각자의 역할과 책임이 있는 소프트웨어 구성 요소를 의미한다.
- 각 계층이 서로 소통이 가능하지만 다른 계층에 직접 간섭하거나 영향을 미치지 않는다.

### 3.1.1 카페와 빵집으로 이해하는 계층
- 카페는 커피, 빵집은 빵을 파는데 서로 협업 관계를 맺고 커피를 사면 빵을 할인할 수도 있다.
	- 이것이 계층 간 소통이다.
- 그러나 빵집 직원이 카페에 가서 커피를 팔 순 없다.
	- 계층은 서로 영향을 끼치지 못한다.
- 스프링 부트는 프레젠테이션, 비즈니스, 퍼시스턴스 계층이 있으며 서로 통신하며 프로그램을 구성한다.
- 계층은 개념의 영역이고 컨트롤러, 서비스 ,리포지터리는 시렞 구현을 위한 영역이다.

#### 프레젠테이션 계층
- HTTP 요청을 받고 요청을 비즈니스 계층으로 전송하는 역할을 한다.
- 컨트롤러가 바로 프레젠테이션 계층 역할을 한다.
- 스프링 부트 내 여러 개 있을 수 있다.

#### 비즈니스 계층
- 모든 비즈니스 로직을 처리한다.
	- 서비스를 만들기 위한 로직을 비즈니스 로직이라 한다.
- 서비스가 비즈니스 계층의 역할을 한다.

#### 퍼시스턴스 계층
- 모든 데이터베이스 관련 로직을 처리한다.
- 데이터베이스에 접근하는 DAO 객체를 사용할 수도 있다.
	- DAO는 데이터베이스 계층과 상호작용하기 위한 객체이다.
- 리포지터리가 퍼시스턴스 계층 역할을 한다.

### 3.1.2 스프링 부트 프로젝트 디렉터리 구성하며 살펴보기
- 정해진 프로젝트 구조는 없지만 추천 프로젝트 구조는 있다.

#### main
- 실제 코드를 작성하는 공간이다.
- 프로젝트 실행에 필요한 소스 코드나 리소스 파일이 모두 해당 폴더에 들어있다.

#### test
- 프로젝트의 소스 코드를 테스트할 목적의 코드나 리소스 파일이 들어있다.

#### build.gradle
- 빌드를 설정하는 파일이다.
- 의존성이나 플러그인 설정 등 빌드에 필요한 설정을 할 때 사용한다.

#### setting.gradle
- 빌드한 프로젝트 정보를 설정하는 파일이다.

### 3.1.3 main 디렉터리 구성하기
- `main/resources/static`
	- JS, CSS, 이미지 등 정적 파일을 넣는다.
	- 해당 디렉터리에 application.yml 파일을 만들어준다. 스프링 부트 서버가 실행되면 자동으로 로딩된다.
		- 데이터베이스 설정 정보, 로깅 설정 정보 등이 들어갈 수 있다.

## 3.2 스프링 부트 3 프로젝트 발전시키기
### build.gradle에 의존성 추가하기
- implementation: 프로젝트 코드가 컴파일 시점과 런타임에모두 해당 라이브러리를 필요로 할 때 사용
- testImplementation: 프로젝트의 테스트 코드를 컴파일하고 실행할 때만 필요한 의존성을 설정, 테스트 코드에서만 사용, 메인 애플리케이션 코드에서는 사용하지 않음
- runtimeOnly: 런타임에만 필요한 의존성을 지정, 컴파일 시에는 필요하지 않지만, 애플리케이션을 실행할 때 필요한 라이브러리 설정
- compileOnly: 컴파일 시에만 필요, 런타임에는 포함되지 않아야 하는 의존성 지정
- annotationProcessor: 컴파일 시에 애너테이션을 처리할 때 사용하는 도구의 의존성 지정

### 작동 확인하기
- application.yml 파일을 수정해준다.
```yaml
spring:
	jpa:
		#전송 쿼리 확인
		show-sql: true
		properties:
			hibernate:
				format_sql: true

		# 테이블 생성 후 data.sql 실행
		defer-datasource-initialization: true
```

## 3.3 스프링 부트 요청-응답 과정 한 방에 이해하기
1. 포스트맨에서 톰캣에 `/test` GET 요청을 한다. 해당 요청은 스프링 부트 내로 이동하는데, 스프링 부트의 디스패처 서블릿이 URL을 분석하고, 요청을 처리할 수 있는 컨트롤러를 찾는다.
	- TestController가 `/test`라는 패스에 대한 GET 요청을 처리할 수 있는 `getAllMembers()` 메서드를 가지고 있으므로 요청을 전달한다.
2. 마침내 `/test` GET 요청을 처리할 수 있는 `getAllMembers()` 메서드와 이 요청이 매칭된다. 그리고 해당 메서드에서 비즈니스 계층과 퍼시스턴스 계층을 통하면서 필요한 데이터를 가져온다.
3. 뷰 리졸버는 템플릿 엔진을 사용해 HTML 문서를 만들거나 JSON, XML 등 데이터를 생성한다.
4. 그 결과 members를 return하고 그 데이터를 포스트맨에서 볼 수 있다.